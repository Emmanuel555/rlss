#define CATCH_CONFIG_MAIN
#include "catch.hpp"

#include <rlss/internal/Statistics.hpp>
#include <random>

TEST_CASE("create statistics test", "[Statistics]") {
    std::vector<double> data {2602.7563071892446,4939.100807153143,1056.6603994179525,5211.35197973637,5023.974749543201,5932.408646004202,3973.660788752824,3593.3008254509436,3850.4645210861545,8624.578513189235,4282.922275311538,2570.4531375961515,9782.164226867671,3908.288336109671,2351.242398282333,814.1907210534849,7949.305471084443,2648.2860913251507,7325.028708460959,475.68741673795546,4466.6352710954325,6348.787579147331,9723.232265249779,1962.1654657770148,3824.569352110467,5620.095446608951,5996.358606163589,92.88895797265883,5731.113179928627,3224.955429286497,153.02709800708024,8837.534805481857,2966.8410476471363,2831.209080036813,7385.494905630324,2147.705952070498,2348.3933693395174,8564.378011850473,6403.039407961384,472.29023124519045,6438.802617312248,1184.721012480785,6496.635210836016,2432.634040538826,4234.722009619586,6040.89607465429,4208.309797107893,9959.667870337757,9378.265047214181,2599.831802577929,6072.677775219589,4368.113580372558,6808.194048546474,1845.830771832302,8721.253857870493,9185.496196559483,7770.935353343055,1786.6273140353994,8863.56977454503,6563.384391616906,5442.118357595053,7702.417704773975,6333.329861387262,4761.8486293475435,5057.802889665256,1368.5125999935499,875.6200626739829,7362.796775677926,436.7628595001538,839.7856460561748,9518.79983497831,9356.082332309485,4684.313737272414,6953.01194118748,5271.268018639293,4809.93562254603,4213.242627483865,6301.681757919836,2920.2107119260613,9720.12637122792,4887.718549455923,5148.066355888686,9134.836547509874,7738.13876490315,92.99752825262631,2037.9334400748994,8262.050024734552,6119.8095286666385,1695.4657264203076,8839.031817120056,9991.289386074943,6069.505831650973,5547.059108936171,8116.535985684354,1921.8918806357465,6345.9222849850485,5874.67773713353,8416.929593483685,9637.041572656803,657.5260762852075,2134.771085547409,6325.754403876516,4440.438031509916,9858.437929928527,6451.641268029697,2841.929086330387,1065.72452820044,9833.487010810677,106.72250987946997,5452.374363763115,5759.084636456795,3409.9829535831705,9709.780851197535,6401.021018399684,829.040510784227,6619.058727893024,8266.362951140503,7661.321748162056,8611.88919801801,8726.570321828942,9370.6596619782,1666.937229811807,6609.630296022085,64.6409950880722,2235.394493862567,9533.03122876208,2791.7810008718134,193.99736966897785,1342.1810493257447,6090.906792012568,9737.102060802727,7370.548335835969,869.453163250703,4602.547766465353,7175.813119529412,1168.7667076108278,3737.558811183476,5262.7431854352935,2996.653017842457,9653.55295228879,8883.139157684407,270.21891788072685,5162.556213069743,3569.6587543905234,7905.571934849804,5496.02413961319,8681.848088334607,2820.249903577654,8546.41597230522,4730.945418535417,4570.429765812284,6196.710076313192,5109.996233894231,6712.514101350627,4804.4807077509595,1532.232056564331,74.9275142358874,7589.1333163000345,8270.934443171585,4172.193133829328,7609.5072359286205,3034.2555845232187,6872.523911675379,1863.7540742900626,3838.3555269261947,3697.975103159813,769.4196178261559,5825.853032268147,4618.238619269471,9456.60435062217,8505.88190032351,4379.091839930653,422.1227535255112,9978.325289491846,3046.2441814257113,2689.459177590555,8169.7775692572895,5870.709303735974,7977.930155296153,8054.782606123567,8908.121379414562,5881.356467576293,717.8891900628747,5153.144948155915,769.3317325911264,5822.669127384636,6081.195022530129,1478.6288659963564,2190.1129573466405,1334.7656852161838,870.3375280250814,2171.820651577222,1700.7704726640338,3442.0682592806406,8597.751057509311,6095.503125293991,8509.118664452786,5952.216033813597,7198.643282529318,7124.625968825256,5752.687242697041,5931.121642541887,4414.066603420381,8081.902036837007,7639.823972572264,5232.4035396982135,5320.546927193131,437.2452035502961,2078.6338380903503,7094.458097983673,6017.286674084815,3724.6718836959235,4185.468581835311,1422.7641344688047,2710.1145816269045,3257.2948268581113,6120.0476393427125,7708.930847953015,2050.3027917424497,4221.369822149705,3684.2432013068214,4109.561039248916,8151.70868663627,3440.0078618366006,4626.12866691669,1495.192317477233,73.16875694064473,8436.449204024735,8930.594180441904,5843.088459926376,9203.848455331883,6566.246058327465,5627.336194600552,6602.8523370874755,7053.478207269194,8485.09564103011,6509.277965137217,9752.399743734672,7403.023440597739,6710.365106320365,2603.8198423301283,4791.129596250034,4308.777757720805,908.5667512429196,9823.00829133719,3639.108479423496,9446.59868892018,7477.909106763886,8233.244977883534,6564.527158753187,8180.72049544015,6094.323804262412,6243.074947851862,233.21548561366478,6738.584290328445,118.63524505505873,4297.622772133333,7886.963115881916,7796.067456323834,6181.458960829019,2023.2225485809886,4427.694244718898,2581.9286639235384,9919.037211133931,4317.791062670473,4960.891418595594,4475.05885586059,2169.2497942970303,4021.1951832394557,8175.106537883588,6941.131100660004,8375.941066806225,4971.56787354667,1028.849737802191,585.3837714074627,7972.59240054232,9082.712323454014,7140.351461854843,6648.126950287927,6479.5495121238455,3263.9830635285407,4268.931202659445,4139.181790406591,6743.52995887201,6085.159764904988,5184.296729532501,8755.002884822567,2197.300673652582,1389.8544134983104,6164.510950835086,8781.409926346038,4696.225774501884,1534.4790118954243,7086.836655199308,9267.313718649377,4214.126867457948,4558.65962275939,6323.586619728114,3796.4757455109775,5965.49420047082,1162.4578297939859,5948.998551581175,8288.30026415415,7699.075697422824,8595.426152245034,1474.796720347723,9212.423978100878,3019.172017327686,9066.698992847294,8618.180519269928,7216.378472562611,547.3918568809144,5960.483201419043,9711.187863260879,9340.102028223333,7907.520186271679,7092.010187223618,1677.4846503005126,6217.403342854237,4918.763052065939,5734.852322484163,4580.841116633142,6226.715567163501,1986.1688418494216,4594.9145328377135,9511.38348783703,1210.998421205247,3927.2287580797783,6945.255302549497,7137.332771439998,6572.052363722404,9013.337754010452,726.1381282701784,8328.771913170143,6000.917369602308,8923.365593904753,8431.172363491802,6549.056469991743,9343.554603724418,8935.39596353917,9010.090900298119,5339.322449872475,6664.953982922176,2760.733220601854,3287.33019106624,117.9982083668496,8740.783628738083,8503.722429090923,8837.424114755584,585.749867941504,1081.3670497159521,693.6369856528346,7649.900469876182,3519.808945537394,5760.053867460471,4674.8022967651395,402.4789465290568,1140.6397694996995,5459.151435980285,5006.818500840195,8986.376832687467,2376.4078437187063,5281.9705355891265,4799.938269117435,6726.187444507992,9136.697718586644,5632.728080845736,4869.122534711707,8018.367473340286,5963.565851814377,6357.890220385114,4786.191520826908,1338.7124761018265,2924.8802697014544,884.5342464919526,943.4674027603019,2171.8617803483676,3091.9469292651115,6426.301276587715,3981.386829895791,45.665181018155195,9832.731050657461,8300.599997009564,9496.05310983232,8267.529290184468,7269.371488481653,3653.8661279420025,139.697840159837,4133.4321754241355,9891.47335145655,9976.64898430081,7559.751098910251,2147.3901760300764,3496.174097455017,4970.032616320423,2274.657168601998,2943.3317219447463,9287.437169002533,3093.717256899644,2974.0773841772084,3227.967913895198,8490.721762348745,9458.162807449873,9566.808265608412,4564.583975567701,5232.308873063876,1370.268075179387,6270.620624079182,1413.9920270241114,9436.578620563492,8341.781700561787,9986.320949090597,8589.112861372567,2145.0192408611856,4792.36733347104,3048.9630793505094,9100.628167261126,355.79375450160325,3053.3558542697115,1619.0516547206246,7916.824681266134,4956.1375184689,269.5030650015995,6367.976634262279,78.32079892738486,5606.596511874072,8458.581339939352,9146.363997598397,3220.5231906861286,2629.996028322377,5459.498573924722,7240.289781408586,1822.480375759913,9664.1066959296,1394.3525220686647,9707.827929294182,8475.513357108464,5507.166676087383,4582.211027264445,2640.1860056939818,2514.896618495882,1094.1435535348176,3684.6933667644553,481.60605422809533,4095.146448059579,5288.434571435535,1656.0802647878104,2394.3442896409374,904.1671841317667,8880.495496687074,755.3095857796822,3474.8429114843384,8775.282826410448,6066.921103392332,5008.810599643464,5276.352593220193,5969.228644392772,1033.2937153621535,1437.4343453517868,4467.328340786744,5759.1015328486965,8584.150452862981,8803.158709702193,9304.364593434968,131.30989366774926,3882.903263703017,6627.261385500696,5328.372104460396,4047.448042143608,1000.4825879616508,7765.420350746217,6947.689743981269,8207.374465037305,973.2240250081625,4207.079741520956,9446.144678591825,4708.321202896352,2726.3832180152704,2181.354316327956,2334.6154801331454,174.8961875231414,3060.5774942083476,3428.567139313409,5035.228632426896,9920.822641446253,3857.3228857881745,2396.6856913003553,4179.542964526152,6147.97019727676,9164.068810204377,4951.9069399092205,5289.724513622156,9790.262305163005,4686.007545494901,6331.177939789319,5488.952317748237,1578.5320645715185,4287.728255336792,5563.955415071335,1029.3997258636912,3369.6540730638767,3486.1042415063916,1296.7585313513118,1861.7001980039327,8976.779544389698,4145.016961573994,3044.916170854387,3087.0531006112355,7288.524125769268,9210.405190224827,2778.302218584178,4171.572671743964,4587.463198944674,8543.777259284228,7819.420685562964,5827.212419223362,2337.3900198259603,9835.304626055813,8133.669937754984,9869.849909240667,5027.666639997477,4153.558206894165,8595.845421164302,8213.575183349069,2104.209879547445,5726.213007343658,8088.188977352173,1386.2168075707293,5019.952443124344,4203.069322735839,535.0424916434338,6654.008119843709,9227.079555549793,8799.255072023681,699.3774028171918,9573.398515125462,7069.479619667866,2569.2636329648467,2413.773676690818,5691.8774101398485,4817.667055356397,3688.90344684761,82.87720537581977,3750.9748678106216,2786.156296701472,4985.264706812977,7532.422691243241,5966.165028169214,7474.361628114906,9728.96319311502,7093.687648782206,9328.49671626989,7210.99526274357,5239.483609406569,1285.84164253287,6932.879297459534,4009.5041495743467,8966.005677068943,68.37267423089655,9375.718202804805,7600.470040944659,9380.353443011229,74.71127480415119,2137.589514922542,8595.747885453738,8430.133533000791,9631.191210461779,879.3576470107245,9414.45533177797,5132.469384349534,2286.029336658554,8712.697853358139,7522.273599508154,9210.728307932808,5977.9148430266,7565.936823124161,499.0929604336547,6605.3515120411885,3696.9195690633283,5085.782824751646,1525.3679857096135,5697.7156428668895,3638.0046621301176,5308.5051464895405,1221.29027957113,2842.2416546478903,999.8369354287473,8634.80835036133,3761.211764565625,8223.069643342993,7325.183020773023,7790.683566906731,1376.273362271987,7913.387900066842,72.8437235159829,1702.6486685246089,1810.2067651390773,182.40717991053646,1498.1876518601878,9676.434428821156,4601.118469348524,968.9539277019621,9421.563561558665,5337.452011779566,5314.9751864667205,7464.532185244833,9973.653240852405,8057.255798877409,8792.789812654537,3191.7123669770876,3794.7124225497373,7882.01754933926,4892.418119977376,8510.641033891492,6186.427112166864,1124.6046224838246,9708.323070182189,8303.574958078214,9688.537003085612,4572.403105314465,7999.491207133914,7372.586409187026,5667.277567327975,8504.083889252002,5405.244444825486,8434.47506475909,9073.723447810899,9482.52043355619,9191.916679073702,7939.707214840928,7091.37220875133,143.26915150231878,8841.916861724583,2804.948657261307,2928.160856295723,6189.731298828857,3748.265862486688,4685.1450467276145,692.6506611974193,5563.654771469731,9316.11579647094,3970.0120577487264,3018.8626879951153,6158.2278113241155,6370.099535616029,9813.365578933488,6090.849378127765,1579.807672743674,4083.7478559853844,2459.266129951998,7929.041329680199,2406.821030914469,372.8916404730542,5784.126704441187,3853.5015830061525,5273.12427556068,2231.522587819391,245.60102297253027,6212.680066534695,9296.0999797031,2236.0584668960946,8408.978554693616,4318.02663897761,2689.200239713563,3985.083989221008,4821.586081950868,6256.238646762593,3778.159142147348,7916.039859485321,1879.3754907220539,2388.7162518243445,7040.5378832355855,507.79825121582746,1743.8827035309578,1009.3936007768812,9084.159299739049,8248.879320479373,8992.498021424095,1254.3461169898228,2289.4636094566436,8216.638648201779,904.5852838364287,7534.4716296597135,2472.7661095598464,1160.1531689354993,1086.3943116705443,5631.8876765436735,6510.1853130521495,6190.135535325659,4884.300649816845,1259.1265094108016,4279.595552627418,2473.5647392509054,5876.426072393233,3085.4613697563373,8761.553527618566,9160.522505410583,603.7766481854189,7086.059556760101,4541.679036730982,9634.605897656304,4301.028118037436,8990.388865367826,5230.0365324319255,6925.065164453583,7313.166838260256,1631.790690443914,7621.356086542277,3162.9118615405473,2617.869311224813,1304.6413774249854,2363.700855947083,923.0511408922382,6995.963243658409,9690.01660205302,1827.2630116620458,3336.4337004555823,6620.358694895225,430.8605469558724,4269.565299406984,5115.862733880156,136.87101839168213,6691.244672720705,1885.5361674137184,4669.956273176311,6077.504081774417,2586.8756412141847,2969.5894849517103,4959.440993573262,7970.442318462106,147.23164196247973,481.8049032329741,4738.980007533284,4547.045154556299,3725.8140707010766,9012.958083690639,594.8675940530146,7447.933558481988,3461.37075028772,949.2714268001556,6601.442165157503,3633.16197607262,442.3644181835307,1710.6952198545077,8916.114325171668,6925.958804126656,8731.114069928444,8810.258228079274,7833.229284706883,5454.634468826555,5182.635273278788,7293.526467101063,7644.3975930373,9033.516521741447,7632.199236445101,7055.749241327319,1267.3003078988277,2771.481939392113,2326.992584783013,7751.254435867465,8623.044811828706,6406.659683181439,1174.960168032161,5143.62128115025,6885.47803699013,3212.5676035644256,3732.715841703267,9152.91511055663,5426.6033518986205,7577.909854057722,2502.30650759779,8483.216025825379,154.43356083387096,5792.048986529175,4044.917670371093,1767.4603337611084,7588.268038323884,2410.033299063521,3813.694453692238,8626.857149676747,2488.6057271220307,8539.518307921953,2356.6980673579374,6024.888812512417,9645.317944270024,1527.465839054709,4155.2813193205975,5955.876745896286,304.3643370225757,2799.480518327698,9239.92850798062,1988.3612904144843,3964.6780162744553,5225.31726705684,9535.331584429063,6354.159394330686,9733.394213989553,6841.34898248618,6970.817510855454,5637.49557611466,2800.715378966808,2665.8564659069116,6942.019998813918,7259.011813185168,9212.84478391429,3120.3599046517616,8115.23836901475,5322.179655643315,7261.858888740697,3362.0790483801743,238.83045271065663,6653.395930184743,7845.902640441388,1543.4882763825608,7278.495823526485,1389.637324387145,3020.156268684251,6725.5416952305095,3762.889728084432,3121.1157065980165,9363.045202472076,7133.883953220359,1713.9574759840782,6524.4082531722415,4203.783620274482,315.72141141076537,2834.188663564936,7580.541574756,9235.38565407515,6965.799531584864,6598.042700911995,1884.671229978605,2150.97866957922,2759.56870832897,6947.040020702413,9089.717265711697,1275.0611878140471,2080.2818691564153,3787.252235272566,8534.587402224639,4354.207212718583,8415.673710622383,7426.318693217894,4741.445031688812,7380.567376418172,7524.348673046147,7963.837518452295,4261.924723699319,9170.457711406976,2009.3164074766944,8932.808122370581,6583.129117373196,1737.1817893191187,2653.458019551336,256.6825230759862,9945.636781528832,4694.911800969652,6371.037644632384,2401.2901559269694,6554.134583216018,1808.5559934222583,4982.781771962846,5002.7961228572385,1442.1366792443257,3224.145156242566,4023.6056466406144,217.75754754441044,3841.9636689253243,6809.521675112678,969.9110642503273,1412.912335487847,9162.341280185516,7665.678525668776,7132.059790053695,6121.586733574621,2557.389148478537,3476.186757037587,6704.657052023558,1544.3817434145024,6726.537944047705,185.18900854392672,4580.429239955536,7665.032592167815,1408.084747906797,3303.8024952981114,7659.774404373185,7171.73185057894,8697.395503218815,3225.635945340903,4507.357323400858,1876.629320668226,3987.6163106461536,7920.091499679926,9903.975102755112,6430.479186967322,6553.10966704391,648.5882259314246,849.1037748500985,6652.193674995877,5616.73754209375,6155.821220551664,7585.645809887387,7825.304977931695,8625.52534124979,7031.533626570563,2243.8215619591183,8362.825224240032,3256.6616473133627,4483.831884414563,2747.5174735960704,9304.802370899031,2862.3667236480455,3314.742100055763,5661.8899557367595,7075.024090714766,9147.490663613278,8980.062282787183,7125.4696670894455,4153.738970093204,750.9871531051471,1463.1451128004858,2102.526788738638,7031.9310195928965,9089.345319602791,9595.342839731022,695.3962359021559,3927.1046963977883,7299.564982638459,4361.416263154477,1564.199583964656,4300.681811094689,1812.6710305548677,3156.338448689837,6859.810679986411,485.34118306976626,5004.228997226966,7161.648199424231,6966.465189367884,6695.019463355663,2873.0876492951907,4985.30094320698,8738.355738312657,8515.569954737264,4507.1516688326265,475.04470506136266,357.57283653799266,8844.951158325302,9557.73541008866,9379.805298680007,601.8994609081541,8717.571514529865,3091.7129155905477,9626.89652637334,8699.809961261008,8558.593486215696,3379.5180940874857,100.39732533456025,2081.2344480493784,3822.9399577229838,3872.8762751882673,1666.7848960700194,5060.107321643203,1824.5894195910894,3159.0175652798325,3305.4917436401543,5110.68141014354,9617.94069243069,9445.082518596051,6823.6094046541575,2734.638372052295,7872.109844803943,869.0514849962206,1905.326077024726,3904.718944803959,9561.884095020105,7678.505972013201,8657.780717927786,1702.8900224435351,2162.717036390105,6772.595671463068,807.9477146722613,3089.714364568903,2239.5404590386925,4615.999475756661,4196.838840014207,2070.445664826127,6399.411160162488,7862.856773184835,8435.3203689627,791.1318630943731,4003.1465705207647,8965.671545952151,7335.955912568877,8808.606088166709,7059.236366670411,4425.542107564397,7054.523241447752,6529.207904935584,2360.7937770770327,2667.1904788749266};


    auto stats = rlss::internal::statistics::createStats<double, double>(data);

    using rlss::internal::statistics::imin;
    using rlss::internal::statistics::imax;
    using rlss::internal::statistics::imean;
    using rlss::internal::statistics::istddev;
    using rlss::internal::statistics::ipopsize;

    REQUIRE(std::abs(std::get<imin>(stats) - 45.6651810181551951473011285997927188873291015625) < 1e-20);
    REQUIRE(std::abs(std::get<imax>(stats) - 9991.28938607494274037890136241912841796875) < 1e-20);
    REQUIRE(std::abs(std::get<imean>(stats) - 5154.8595210140183553448878228664398193359375) < 1e-9);
    REQUIRE(std::abs(std::get<istddev>(stats) - 2887.88677574861139873974025249481201171875) < 1e-9);
    REQUIRE(std::get<ipopsize>(stats) == data.size());
}

TEST_CASE("create statistics edge case test", "[Statistics]") {
    using namespace rlss::internal::statistics;

    std::vector<double> empty;
    auto empty_stats = zeroStats<double, double>();
    REQUIRE(std::get<imin>(empty_stats) == std::numeric_limits<double>::max());
    REQUIRE(std::get<imax>(empty_stats) == std::numeric_limits<double>::lowest());
    REQUIRE(std::get<imean>(empty_stats) == 0);
    REQUIRE(std::get<istddev>(empty_stats) == 0);
    REQUIRE(std::get<ipopsize>(empty_stats) == 0);

    auto empty_combine_empty = combineStats<double, double>(empty_stats, empty_stats);
    REQUIRE(std::get<imin>(empty_combine_empty) == std::numeric_limits<double>::max());
    REQUIRE(std::get<imax>(empty_combine_empty) == std::numeric_limits<double>::lowest());
    REQUIRE(std::get<imean>(empty_combine_empty) == 0);
    REQUIRE(std::get<istddev>(empty_combine_empty) == 0);
    REQUIRE(std::get<ipopsize>(empty_combine_empty) == 0);

    std::vector<double> one_elem {3};
    auto one_elem_stats = createStats<double, double>(one_elem);
    REQUIRE(std::get<imin>(one_elem_stats) == 3);
    REQUIRE(std::get<imax>(one_elem_stats) == 3);
    REQUIRE(std::get<imean>(one_elem_stats) == 3);
    REQUIRE(std::get<istddev>(one_elem_stats) == 0);
    REQUIRE(std::get<ipopsize>(one_elem_stats) == 1);

    auto one_elem_combine_empty_stats
            = combineStats<double, double>(one_elem_stats, empty_stats);
    REQUIRE(std::get<imin>(one_elem_combine_empty_stats) == 3);
    REQUIRE(std::get<imax>(one_elem_combine_empty_stats) == 3);
    REQUIRE(std::get<imean>(one_elem_combine_empty_stats) == 3);
    REQUIRE(std::get<istddev>(one_elem_combine_empty_stats) == 0);
    REQUIRE(std::get<ipopsize>(one_elem_combine_empty_stats) == 1);

    std::vector<double> one_elem_2 {17};
    auto one_elem_2_stats = createStats<double, double>(one_elem_2);
    REQUIRE(std::get<imin>(one_elem_2_stats) == 17);
    REQUIRE(std::get<imax>(one_elem_2_stats) == 17);
    REQUIRE(std::get<imean>(one_elem_2_stats) == 17);
    REQUIRE(std::get<istddev>(one_elem_2_stats) == 0);
    REQUIRE(std::get<ipopsize>(one_elem_2_stats) == 1);

    auto two_one_elem_combined
        = combineStats<double, double>(one_elem_stats, one_elem_2_stats);

    REQUIRE(std::get<imin>(two_one_elem_combined) == 3);
    REQUIRE(std::get<imax>(two_one_elem_combined) == 17);
    REQUIRE(std::get<imean>(two_one_elem_combined) == 10);
    REQUIRE(std::abs(std::get<istddev>(two_one_elem_combined)
                - 9.8994949366116653521885382360778748989105224609375) < 1e-10);
    REQUIRE(std::get<ipopsize>(two_one_elem_combined) == 2);
}

TEST_CASE("combine statistics test", "[Statistics]") {
    std::random_device seed;
    std::mt19937 ran(seed());
    std::uniform_real_distribution<double> dis(0, 100000);
    std::uniform_int_distribution<int> dis2(100, 500);
    std::vector<double> first_ds(dis2(ran));
    std::vector<double> second_ds(dis2(ran));


    for(std::size_t i = 0; i < first_ds.size(); i++) {
        first_ds[i] = dis(ran);
    }

    for(std::size_t i = 0; i < second_ds.size(); i++) {
        second_ds[i] = dis(ran);
    }

    std::vector<double> combined_ds(first_ds);
    combined_ds.insert(combined_ds.end(), second_ds.begin(), second_ds.end());

    auto stats1 = rlss::internal::statistics::createStats<double, double>(first_ds);
    auto stats2 = rlss::internal::statistics::createStats<double, double>(second_ds);
    auto combined_stats = rlss::internal::statistics::createStats<double, double>(combined_ds);
    auto combined_stats_2
        = rlss::internal::statistics::combineStats(stats1, stats2);

    using rlss::internal::statistics::imin;
    using rlss::internal::statistics::imax;
    using rlss::internal::statistics::imean;
    using rlss::internal::statistics::istddev;
    using rlss::internal::statistics::ipopsize;


    REQUIRE(std::get<imin>(combined_stats)
            == std::get<imin>(combined_stats_2)
    );
    REQUIRE(std::get<imax>(combined_stats)
            == std::get<imax>(combined_stats_2)
    );
    REQUIRE((std::get<imean>(combined_stats)
            - std::get<imean>(combined_stats_2)) < 1e-9
    );
    REQUIRE((std::get<istddev>(combined_stats)
             - std::get<istddev>(combined_stats_2)) < 1e-9
    );
    REQUIRE(std::get<ipopsize>(combined_stats)
                  == std::get<ipopsize>(combined_stats_2)
    );
}